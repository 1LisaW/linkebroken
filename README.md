# Чекалка сломанных ссылок

Мини-интерфейс для проверки редиректов и сломанных ссылок.

- умеет проверять в глубину,
- не дергает ссылки на бэкенд,
- пропускает проблемные ссылки,
- ищет страницы даже в дата-атрибутах и стилях,
- генерирует отчеты.

[В опеншифте](http://linkebroken.utm.sigma.sbrf.ru/)

Т.к. Openshift не имеет доступ вовне, сервер стартует с `DISABLE_EXTERNAL=1`
с отключенной проверкой всех внешних ссылок. Если требуется более глубокая проверка,
пока есть возможность запустить только локально.

С не-master раскатывается на [тестовый стенд](http://linkebroken-test.utm.sigma.sbrf.ru/)

Также можно держать ссылку сразу на нужную ссылку `/?depth=-1&url=https://www.sberbank-ru.ift.sberbank.ru/ru/person`.

Сам кроулинг linkinator'а не используется, т.к. может зависать на редиректах пока что.

Авторы linkinator пока не хотят изменений по style / data-атрибутам, поэтому
используем форк `linkinator-css-edition`. Плюс там могут появиться наши фичи.

## TODO

- запуск демо одной командой (экспресс - на дев-сервере)
- сделать параллельную проверку (сейчас прототипно на эффекте по одной)

Доработка опций:
- опция для скипа ссылок при проверке
- robots (см. ниже)

Доработка: реорганизация фильтров
- т.к. появятся разные классы фильтров, реорганизовать
- быстрая фильтрация по результатам текст
- предупреждения (см. ниже)

Доработка: Группировать одинаковые ссылки (одинаковые на всех страницах) 
- не проверять их на каждой странице (меню и т.д.)
- либо временный кеш проверенных ссылок на сервере
- отображать в интерфейсе отдельным блоком.

Доработка: linkinator научить отдавать оригинал ссылки (как указана в странице) для:
- легче искать,
- помечать относительные ссылки на страницах ("./some", "some") как предупреждения
- русский текст в ссылке
- странные символы в ссылке

Доработка: linkinator / gaxios - код редиректа, цепочка редиректов

Доработка: linkinator научить отдавать оригинал тега html, где нашли:
- отображать в интерфейсе,
- для .../img/iframe/background - ругаться на http (несекьюрные)

Доработка: linkinator научить искать robots-тег
- помечать страницы, которые не индекс
- научить robots.txt
- по флагу игнорить?

## Демо-режим

Запуск сборки фронтенда в демо-режиме на `http://localhost:7777`

    npm run dev:front

Запуск эмуляции бэкенда (пока не одной командой)

    npm run dev:back

Последний так же может получать настройки как из env-переменных, так и `.env`.


### На сервере

Собираем статику, запускаем сервер, который реализуета API и хостит статику.

    npm run build
    npm run start

Helm-чарт и Jenkinsfile описывает, как подняться.

### Версионирование

- **Для фиксов**: `npm version patch`: v0.0.1 => v0.0.2
- **Для фич**: `npm version minor`: v0.0.2 => v0.1.0
- **Релиз**: `npm version major`: v1.0.0-rc.1 => v1.0.0
